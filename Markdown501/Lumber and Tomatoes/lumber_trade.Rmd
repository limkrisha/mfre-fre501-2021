---
output:
  word_document: default
  html_document: default
---

# Canada U.S. Trade in Softwood Lumber

## Data

The data come from a 2014 paper by by Johnston and Parajulib[https://www.researchgate.net/publication/320880691_What's_next_in_the_US-Canada_softwood_lumber_dispute_An_economic_analysis_of_restrictive_trade_policy_measures/link/5a00c349aca2725286dfb2b9/download]   .

The data can be aggregated to arrive at the following values:

CANADA                   |    
------------------------ | ------------- 
Price ($/m^3)            | 169       
Production (10^3 m^3)    | 58151 
Consumption (10^3 m^3)   | 19711
Export to U.S. (10^3 m^3)| 28277
Expot to ROW (10^3 m^3)  | 10163

U.S.                     |    
------------------------ | ------------- 
Price ($/m^3)            | 181       
Production (10^3 m^3)    | 71415 
Consumption (10^3 m^3)   | 100181
Import from Can (10^3 m^3)| 28277
Import from ROW (10^3 m^3)  | 489

We will work with Canadian supply net of exports to the rest of the world (ROW) and U.S. imports net of imports from the ROW. 

The domestic price, supply and demand variables are defined as follows:

```{r}
P_can <- 169
P_US <- 181
(Q_can_S <- 58151 - 10163) 
Q_can_D <- 19711
Q_US_S <- 71415
(Q_US_D <- 100181 - 489)
```
 
The demand and supply elasticities (measured at the above prices and quantities) are the same for Canada and the U.S.  
```{r} 
E_D <- -0.17 
E_S <- 0.15 
``` 
## Construcing the Demand and Supply Schedules

The inverse demand and supply schedules for Canada can be expressed as

$P^{can} = a_{can} - b_{can} Q_{can}^D$ 
and 
$P^{can} = \alpha_{can} + \beta_{can} Q_{can}^S$. 

The schedulesfor the U.S. can be expressed as 
$P^{US} = a_{US} - b_{US} Q_{US}^D$ 
and 
$P^{US} = \alpha_{US} + \beta_{US} Q_{US}^S$. 

Recall the method for constructing demand and supply equations from elasticty assumptions and point estimates of quantity and price. Applying those methods here gives: 

Solution:
```{r} 
(b_can <- -1/E_D*P_can/Q_can_D) 
(a_can <- P_can + b_can*Q_can_D ) 
(beta_can <- 1/E_S*P_can/Q_can_S) 
(alpha_can <- P_can - beta_can*Q_can_S )
(b_US <- -1/E_D*P_US/Q_US_D) 
(a_US <- P_US + b_US*Q_US_D ) 
(beta_US <- 1/E_S*P_US/Q_US_S) 
(alpha_US <- P_US - beta_US*Q_US_S )

```
Check (should evaluate to zero)
```{r} 
P_can - (a_can-b_can*Q_can_D) 
P_US - (a_US-b_US*Q_US_D) 
```
## Estimating Transportation Cost
We will keep things simple by assuming a per unit transportation and tariff rather than an ad valorem (i.e., percentage). Let $C$ denote the combined transportation cost plust tariff. 

Using the prices from the table above we can calculate: $C = P_{US}-P_{Can}=$ `r C <-P_US - P_can ` `r C`.

## Market Clearing Conditions

Let $T_{ij}$ denote shipments from country $i$ to country $j$. 

$T_{cc}$ denotes shipments from Canada to Canada (at zero cost);
$T_{cs}$ denotes shipments from Canada to the U.S. at cost $C$ per unit.

Market clearing for Canada requires 
$Q_{can}^S = T_{cc}+T_{cu}$ 
and 
$Q_{can}^D=T_{cc} + T_{uc}$. 

A similar pair of equations holds for the U.S.

## Net Welfare
We previously saw that net welfare is the sum of the areas under the two demand curves minus the area under the two supply curves minus total transportation costs.

The welfare functions depend on the demand and supply quantities. However, we can substitute $T_{cc}+T_{cu}$ for $Q_{can}^S$, substitute $T_{cc} + T_{us}$ for $Q_{can}^D$, etc. 

We can now write an expression for net welfare as a function of $T_{cc}$, $T_{cu}$, $T_{uc}$ and $T_{uu}$.

Solution:
$$
\begin{aligned}
  NAW & = \left (a_{can}-0.5*b_{can}[T_{cc}+T_{uc}] \right )[T_{cc}+T_{uc}] \\
   & + \left (a_{US}-0.5*b_{US}[T_{cu}+T_{uu}] \right )[T_{cu}+T_{uu}] \\
   & -0.5 \left (alpha_{can}+beta_{can}[T_{cc}+T_{cu}] \right )\left ( [T_{cc}+T_{cu}] +\frac{\alpha_{can}}{\beta_{can}}\right )\\
   & -0.5 \left (alpha_{US}+beta_{US}[T_{uc}+T_{uu}] \right )\left ( [T_{uc}+T_{uu}] +\frac{\alpha_{US}}{\beta_{US}}\right )\\
   & -(T_{cu}+T_{uc})C
\end{aligned}
$$

## Setting up the Optimization Problem

Use the optim() function in R to choose non-negative values for $T_{cc}$, $T_{cu}$, $T_{uc}$ and $T_{uu}$ which maximize net welfare (NW). 

Use $T_{cc}=0.5*Q_{can}^S$, $T_{cu}=0.5*Q_{can}^S$, $T_{uc}=0$ and $T_{uu}=Q_{US}^S$ as starting values in the optimization routine. 

Arrange the T values in a vector with $T_{cc}$ first, $T_{cu}$ second, $T_{uc}$ third and $T_{uu}$ fourth.
```{r}
welfare <- function(T) {
  D_can <- (a_can - 0.5*b_can*(T[1]+T[3]))*(T[1]+T[3])
  D_US <- (a_US - 0.5*b_US*(T[2]+T[4]))*(T[2]+T[4])
  S_can <- 0.5*(alpha_can+beta_can*(T[1]+T[2]))*(T[1]+T[2]+alpha_can/beta_can)
  S_US <- 0.5*(alpha_US+beta_US*(T[3]+T[4]))*(T[3]+T[4]+alpha_US/beta_US)
  Sig_C <- C*(T[2]+T[3])
  NAW_minus <- -(D_can+D_US-S_can-S_US-Sig_C)
}
test <- welfare(c(0.5*Q_can_S,0.5*Q_can_S,0,Q_US_S))
test
```
## OPtimal Solution

Use the optim() function to solve the minimization problem. It is important to restrict the choice variables to non-negative values.

We expect the solution to be identical to the original values for supply, demand and price as shown in the table above. This is because the original values satisfy the LOP.
```{r}
solution <- optim(par=c(0.5*Q_can_S,0.5*Q_can_S,0,Q_US_S), fn=welfare, lower=c(0,0,0,0), method="L-BFGS-B" )$par
(Ship_can_can <- solution[1])
(ship_can_us <- solution[2])
(ship_us_can <- solution[3])
(ship_us_us <- solution[4])
```

## Using the model for Policy Analysis
Suppose the combined transportation and tariff as measured by $C$ increases from 12 to 40 as a result of a carbon tax or change in U.S. policy. 

Use the previous optimization method to determine how the Canadian and U.S. price is impacted by this change. 

Is there a significant impact on trade between the two countries? Briefly explain.

Solution:
```{r}
C <- 40
welfare2 <- function(T) {
  D_can2 <- (a_can - 0.5*b_can*(T[1]+T[3]))*(T[1]+T[3])
  D_US2 <- (a_US - 0.5*b_US*(T[2]+T[4]))*(T[2]+T[4])
  S_can2 <- 0.5*(alpha_can+beta_can*(T[1]+T[2]))*(T[1]+T[2]+alpha_can/beta_can)
  S_US2 <- 0.5*(alpha_US+beta_US*(T[3]+T[4]))*(T[3]+T[4]+alpha_US/beta_US)
  Sig_C2 <- C*(T[2]+T[3])
  NAW_minus2 <- -(D_can2+D_US2-S_can2-S_US2-Sig_C2)
}
solution2 <- optim(par=c(0.5*Q_can_S,0.5*Q_can_S,0,Q_US_S), fn=welfare, lower=c(0,0,0,0), method="L-BFGS-B" )$par
(Ship_can_can2 <- solution2[1])
(ship_can_us2 <- solution2[2])
(ship_us_can2 <- solution2[3])
(ship_us_us2 <- solution2[4])
```